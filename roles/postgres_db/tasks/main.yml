- name: Détection du serveur PostgreSQL primaire
  import_tasks: patroni.yml
  when: postgresql_patroni_hosts | length > 0

- name: Création de la base de données PostgreSQL
  community.postgresql.postgresql_db:
    name: "{{ postgresql_db_name }}"
    state: present
  become_user: postgres
  delegate_to: "{{ postgresql_patroni_primary_host | default(inventory_hostname) }}"

- name: Création de l'utilisateur PostgreSQL {{ postgresql_db_name }}
  community.postgresql.postgresql_user:
    db: "{{ postgresql_db_name }}"
    name: "{{ postgresql_db_name }}"
    password: "{{ postgresql_db_password }}"
    priv: ALL
  become_user: postgres
  delegate_to: "{{ postgresql_patroni_primary_host | default(inventory_hostname) }}"
  no_log: true
