- name: Copie de la configuration de Nextcloud
  copy:
    content: "{{ nextcloud_config | to_json }}"
    dest: "{{ nextcloud_import_file }}"
    owner: "{{ web_app_owner }}"
    group: "{{ web_app_group }}"
    mode: "640"
  register: _nextcloud_import

- name: Configuration de Nextcloud  # noqa no-handler
  command: "{{ php_executable }} occ config:import {{ nextcloud_import_file | quote }}"
  args:
    chdir: "{{ web_app_dist_dir }}"
  become_user: "{{ web_app_owner }}"
  when: _nextcloud_import is changed
  notify:
    - reload php-fpm

- name: Trigger Nextcloud handlers
  meta: flush_handlers
