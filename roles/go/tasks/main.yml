- name: Création du dossier d'installation de Go v{{ go_version }}
  file:
    path: /opt/go/{{ go_version }}
    owner: root
    group: root
    mode: "u=rwx,go=rx"
    state: directory

- name: Téléchargement de la checksum de Go v{{ go_version }}
  uri:
    url: https://dl.google.com/go/go{{ go_version }}.linux-amd64.tar.gz.sha256
    return_content: true
  register: go_checksum

- name: Téléchargement de l'archive de Go v{{ go_version }}
  get_url:
    url: https://dl.google.com/go/go{{ go_version }}.linux-amd64.tar.gz
    checksum: sha256:{{ go_checksum.content }}
    dest: /usr/local/src/go{{ go_version }}.tar.gz
    mode: "u=rw,go=r"
    owner: root
    group: root

- name: Décompression de l'archive
  unarchive:
    src: /usr/local/src/go{{ go_version }}.tar.gz
    dest: /opt/go/{{ go_version }}
    remote_src: true
    creates: /opt/go/{{ go_version }}/bin/go
    extra_opts:
      - --strip-components=1
    owner: root
    group: root

- name: Création du lien symbolique pour le binaire go{{ go_version }}
  file:
    src: /opt/go/{{ go_version }}/bin/go
    dest: /usr/local/bin/go{{ go_version }}
    state: link
    owner: root
    group: root
    mode: "u=rwx,go=rx"

- name: Installaiton des outils de compilation
  package:
    name: build-essential
    state: present
