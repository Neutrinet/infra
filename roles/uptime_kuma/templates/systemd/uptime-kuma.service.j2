{{ ansible_managed | comment }}

[Unit]
Description=Uptime Kuma: monitoring tool
After=network.target

[Service]
Type=simple
Restart=always
User={{ uptime_kuma_owner }}
Group={{ uptime_kuma_owner }}

WorkingDirectory=/var/www/{{ uptime_kuma_owner }}/dist/
ExecStart=node server/server.js --port=3001
StandardOutput=append:/var/log/uptime-kuma/{{ uptime_kuma_owner }}.log
StandardError=inherit

NoNewPrivileges=no
PrivateTmp=yes

# Denying access to capabilities that should not be relevant for webapps
# Doc: https://man7.org/linux/man-pages/man7/capabilities.7.html
CapabilityBoundingSet=~CAP_RAWIO CAP_MKNOD
CapabilityBoundingSet=~CAP_AUDIT_CONTROL CAP_AUDIT_READ CAP_AUDIT_WRITE
CapabilityBoundingSet=~CAP_SYS_BOOT CAP_SYS_TIME CAP_SYS_MODULE CAP_SYS_PACCT
CapabilityBoundingSet=~CAP_LEASE CAP_LINUX_IMMUTABLE CAP_IPC_LOCK
CapabilityBoundingSet=~CAP_BLOCK_SUSPEND CAP_WAKE_ALARM
CapabilityBoundingSet=~CAP_SYS_TTY_CONFIG
CapabilityBoundingSet=~CAP_MAC_ADMIN CAP_MAC_OVERRIDE
#CapabilityBoundingSet=~CAP_NET_ADMIN CAP_NET_BROADCAST CAP_NET_RAW
CapabilityBoundingSet=~CAP_SYS_ADMIN CAP_SYS_PTRACE CAP_SYSLOG 

[Install]
WantedBy=multi-user.target
