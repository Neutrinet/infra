---
- name: Config de etcd
  ansible.builtin.template:
    src: etcd.j2
    dest: /etc/default/etcd
    owner: root
    group: root
    mode: "u=rw,go=r"
  vars:
    etcd_current_member: "{{ etcd_members | selectattr('name', '==', ansible_hostname) | first }}"
  notify: Restart etcd

- name: Installation de etcd
  ansible.builtin.package:
    name:
      - etcd-client
      - etcd-server
    state: present

- name: Activation de etcd au d√©marrage
  ansible.builtin.service:
    name: etcd
    state: started
    enabled: true

- name: Configuration de vector
  ansible.builtin.template:
    src: vector/prometheus_etcd_exporter.yaml.j2
    dest: /etc/vector/sources/prometheus_etcd_exporter.yaml
    owner: vector
    group: vector
    mode: "ug=r,o="
  notify: Restart vector
  tags: ['vector_config']
