---
- name: Config de etcd
  ansible.builtin.template:
    src: etcd.j2
    dest: /etc/default/etcd
    owner: root
    group: root
    mode: "u=rw,go=r"
  vars:
    etcd_current_member: "{{ etcd_members | selectattr('name', '==', ansible_hostname) | first }}"
  notify: restart etcd

- name: Installation de etcd
  ansible.builtin.package:
    name:
      - etcd
      - etcd-client
      - etcd-server
    state: present

- name: Activation de etcd au d√©marrage
  ansible.builtin.service:
    name: etcd
    state: started
    enabled: true

- name: Installation des plugins Telegraf
  ansible.builtin.template:
    src: telegraf/etcd.conf.j2
    dest: /etc/telegraf/telegraf.d/etcd.conf
    owner: telegraf
    group: telegraf
    mode: "u=rw,g=r,o="
    validate: telegraf --config %s --test
  notify: restart telegraf
  tags: ['telegraf_config']
