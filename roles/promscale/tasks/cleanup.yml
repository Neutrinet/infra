- name: Récupération de la liste des binaires
  find:
    path: /opt/promscale
    file_type: file
    use_regex: true
    pattern: '^[0-9]+\.[0-9]+\.[0-9]+$'
  register: _promscale_binaries

- name: Suppression des anciens binaires
  file:
    path: "{{ binary.path }}"
    state: absent
  loop: "{{ _promscale_binaries.files }}"
  loop_control:
    loop_var: binary
    label: "{{ binary.path }}"
  when: promscale_old_version != promscale_version
  vars:
    promscale_old_version: "{{ binary.path | replace('/opt/promscale/', '') }}"
