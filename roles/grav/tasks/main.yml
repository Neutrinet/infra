---
- name: Installation de Caddy2
  import_role:
    name: caddy_server
  tags: ['caddy']

- name: Installation de PHP
  import_role:
    name: php_fpm
  tags: ['php_fpm']

# TODO: Activation modules openssl et zip dans /etc/php/x.x/cli/php.ini cf. https://learn.getgrav.org/16/basics/requirements#php-requirements

- name: Configuration du site (caddy, php-fpm, etc.)
  import_role:
    name: web_app
  vars:
    web_app_domain: "{{ grav_domain }}"
    web_app_template: caddy/grav.j2
    web_app_php_fpm_enabled: true
  tags: ['web_app']

# - name: Téléchargement des sources de Grav {{ grav_version }} et vérification de la signature GPG
#   import_role:
#     name: gpg_signature
#   vars:
#     gpg_public_key_url: "{{ nextcloud_gpg_public_key_url }}"
#     gpg_checksum_algorithm: "{{ nextcloud_checksum_algorithm }}"
#     gpg_verify_url: "{{ nextcloud_install_url }}"
#     gpg_verify_dir: "{{ nextcloud_src_dir }}"
#     gpg_verify_path: "{{ nextcloud_src_archive }}"
#     gpg_verify_owner: "{{ web_app_owner }}"
#     gpg_verify_group: "{{ web_app_group }}"
#     gpg_verify_mode: "u=rw,go=r"
