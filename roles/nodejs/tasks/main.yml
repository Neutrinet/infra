---
- name: Ajout de la clé GPG de NodeJS dans APT
  ansible.builtin.get_url:
    url: https://deb.nodesource.com/gpgkey/nodesource.gpg.key
    dest: /etc/apt/keyrings/nodejs.asc
    owner: root
    group: root
    mode: "ugo=r"
    force: true

- name: Suppression de l'ancien dépôt APT pour NodeJS
  ansible.builtin.apt_repository:
    repo: deb https://deb.nodesource.com/node_{{ nodejs_major_version }}.x {{ ansible_distribution_release }} main
    filename: nodejs
    state: absent

- name: Ajout du dépôt APT pour NodeJS
  ansible.builtin.apt_repository:
    repo: deb [signed-by=/etc/apt/keyrings/nodejs.asc] https://deb.nodesource.com/node_{{ nodejs_major_version }}.x {{ ansible_distribution_release }} main
    filename: nodejs
    state: present

- name: Installation de NodeJS
  ansible.builtin.package:
    name: nodejs
    state: present
