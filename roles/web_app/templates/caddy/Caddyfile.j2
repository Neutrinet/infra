{{ ansible_managed | comment }}

{% for domain in [web_app_domain] + web_app_alt_domains %}
http://{{ domain }}{% if not loop.last %}, {% endif %}
{% endfor %} {
    root * {{ web_app_dist_dir | to_json }}
    encode gzip
    file_server

{% if web_app_php_fpm_enabled %}
    php_fastcgi unix/{{ php_fpm_socket_file }} {
        trusted_proxies {{ caddy_trusted_proxies | join(' ') }}
    }
{% endif %}

    log {
        output file {{ web_app_caddy_log | to_json }}
    }
}
