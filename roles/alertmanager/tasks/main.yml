- import_tasks: user.yml
  tags: ['user']

- import_tasks: alertmanager.yml
  tags: ['alertmanager']

- import_tasks: cleanup.yml
  tags: ['cleanup']

- import_tasks: rules.yml
  tags: ['rules']

- name: Installation de matrix-goneb
  import_tasks: matrix-goneb.yml
  tags: ['matrix_goneb']

- name: Installation de matrix-alertbot
  import_tasks: matrix-alertbot.yml
  tags: ['matrix_alertbot']

- name: Configuration des backups Borgmatic
  ansible.builtin.template:
    src: borgmatic/{{ config }}.yml.j2
    dest: /etc/borgmatic.d/{{ config }}.yml
    owner: root
    group: root
    mode: "u=rw,go="
    validate: /opt/borgmatic/bin/validate-borgmatic-config -c %s
  loop:
    - alertmanager
    - matrix-goneb
    - matrix-alertbot
  loop_control:
    loop_var: config
  tags: ['borgmatic_config']
