groups:
  - name: Health
    rules:
      - alert: Instance Down
        for: 5m
        expr: up == 0
        labels:
          severity: critical
        annotations:
          description: 'Instance {{ $labels.instance }} is down'
          summary: 'Instance is down'

  - name: Disk Usage
    rules:
      - alert: Low Disk Space
        for: 1h
        expr: disk_used_percent > 90
        labels:
          severity: critical
        annotations:
          description: 'Device {{ $labels.device }} mounted on "{{ $labels.path }}" has low disk space (value = {{ humanize $value }}%)'
          summary: 'Disk usage is at {{ humanize $value }}%'

      - alert: Disk Full Next Week
        for: 1h
        expr: disk_used_percent > 80 and on (instance, host, device) (predict_linear(disk_used_percent[2d], 7 * 24 * 3600)) > 100
        labels:
          severity: critical
        annotations:
          description: "Based on disk usage from last 2 days, the {{ $labels.host }} host's device {{ $labels.device }} mounted on "{{ $labels.path }}" will be full within the week (current = {{ humanize $value }}%)"
          summary: 'Disk full within the week (current = {{ humanize $value }}%)'

  - name: Memory Usage
    rules:
      - alert: High Memory Usage
        for: 15m
        expr: mem_used_percent > 90
        labels:
          severity: critical
        annotations:
          description: 'Memory usage is higher than 90% (value = {{ humanize $value }}%)'
          summary: 'Memory usage is at {{ humanize $value }}%'

      - alert: Memory Full Next Week
        for: 1h
        expr: mem_used_percent > 80 and on (instance, host) predict_linear(mem_used_percent[2d], 7*24*3600) > 100
        labels:
          severity: critical
        annotations:
          description: 'Based on memory usage from last 2 days, the host {{ $labels.host }} will be out of memory within the week (current = {{ humanize $value }}%)'
          summary: 'Memory full within the week (current = {{ humanize $value }}%)'

  - name: CPU Usage
    rules:
      - alert: High CPU Usage
        for: 15m
        expr: 100 * system_load5 / system_n_cpus > 90
        labels:
          severity: critical
        annotations:
          description: 'CPU usage is higher than 90% (value = {{ humanize $value }}%)'
          summary: 'CPU usage is at {{ humanize $value }}%'
