- name: Détection du serveur PostgreSQL primaire
  import_tasks: postgresql/primary.yml
  when: postgresql_cluster_hosts | length > 0

- name: Création de la base de données PostgreSQL
  community.postgresql.postgresql_db:
    name: "{{ web_app_owner }}"
    state: present
  become_user: postgres
  delegate_to: "{{ postgresql_primary_host | default(inventory_hostname) }}"
  tags: ['postgres']

- name: Création de l'utilisateur PostgreSQL {{ web_app_owner }}
  community.postgresql.postgresql_user:
    db: "{{ web_app_owner }}"
    name: "{{ web_app_owner }}"
    password: "{{ backoffice_postgresql_password }}"
    priv: ALL
  become_user: postgres
  delegate_to: "{{ postgresql_primary_host | default(inventory_hostname) }}"
  no_log: true
  tags: ['postgres']
