- name: Copie de la configuration Telegraf
  template:
    src: "{{ telegraf_plugin_template }}"
    dest: "{{ telegraf_plugin_dir }}/{{ telegraf_plugin_name }}.conf"
    owner: "{{ telegraf_owner }}"
    group: "{{ telegraf_group }}"
    mode: "u=rw,g=r,o="
  notify: restart telegraf

- name: Ajout de groupes Ã  l'utilisateur telegraf
  user:
    name: telegraf
    groups: "{{ telegraf_append_groups }}"
    append: true
  notify: restart telegraf
  when: telegraf_append_groups | length > 0

- name: Trigger Telegraf handlers
  meta: flush_handlers
