---
- name: CrÃ©ation du certificat {{ domain }} ecdsa
  ansible.builtin.command:
    cmd: >
      /opt/letsencrypt/bin/certbot certonly
      --non-interactive
      {% if letsencrypt_staging %}--staging {% endif %}
      {% if letsencrypt_post_hook != "" %}--post-hook '{{ letsencrypt_post_hook }}' {% endif %}
      {% if letsencrypt_deploy_hook != "" %}--deploy-hook {{ letsencrypt_deploy_hook }} {% endif %}
      --authenticator dns-ovh
      --dns-ovh-credentials /etc/letsencrypt/ovh/ovh.ini
      --dns-ovh-propagation-seconds 30
      --key-type ecdsa
      --cert-name {{ domain | replace('.', '-') }}-ecdsa
      --domain {{ domain }}
      --domain *.{{ domain }}
    creates: /etc/letsencrypt/live/{{ domain | replace('.', '-') }}-ecdsa/cert.pem
