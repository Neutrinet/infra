---

- name: Changement de la timezone vers UTC
  ansible.builtin.file:
    src: /usr/share/zoneinfo/Etc/UTC
    dest: /etc/localtime
    state: link
    force: true
  tags: ['timezone']

- name: Désinstallation de NTP et Chrony
  # See https://github.com/ilri/rmg-ansible-public/issues/46
  ansible.builtin.package:
    name:
      - ntp
      - chrony
    state: absent
  tags: ['ntp']

- name: Installation de systemd-timesyncd
  ansible.builtin.package:
    name: systemd-timesyncd
    state: present
  when:
    - ansible_distribution_release == 'bullseye'
    - ansible_virtualization_type != 'lxc'
  tags: ['ntp']

- name: Activation de systemd-timesyncd au démarrage
  ansible.builtin.service:
    name: systemd-timesyncd
    state: started
    enabled: true
  when: ansible_virtualization_type != 'lxc'
  tags: ['ntp']
