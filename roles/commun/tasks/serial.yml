---

- name: Enable serial ttyS0
  lineinfile:
    path: "/etc/default/grub"
    regexp: 'GRUB_CMDLINE_LINUX_DEFAULT="(.*)"'
    line: 'GRUB_CMDLINE_LINUX_DEFAULT="console=ttyS0,115200n8 console=tty0 quiet"'
  notify: update grub

- name: Clean option grub
  lineinfile:
    path: "/etc/default/grub"
    regexp: 'GRUB_CMDLINE_LINUX="(.*)"'
    line: 'GRUB_CMDLINE_LINUX=""'
  notify: update grub

- name: Enable serial and console in grub
  lineinfile:
    path: "/etc/default/grub"
    line: 'GRUB_TERMINAL="serial console"'
    mode: "u=rw,go=r"
    create: true
  notify: update grub

- name: Config serial speed in grub
  lineinfile:
    path: "/etc/default/grub"
    line: 'GRUB_SERIAL_COMMAND="serial --speed=115200 --unit=0 --word=8 --parity=no --stop=1"'
    mode: "u=rw,go=r"
    create: true
  notify: update grub

- name: Trigger Grub handlers
  meta: flush_handlers
