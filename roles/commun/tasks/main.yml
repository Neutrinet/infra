---
# Rôle commun à tous les hosts
- name: Configuration des dépôts APT
  ansible.builtin.import_tasks: repos.yml
  tags: ['repos']

- name: Configuration du message de bienvenue du serveur
  ansible.builtin.import_tasks: motd.yml
  tags: ['motd']

- name: Configuration du serveur SSH
  ansible.builtin.import_tasks: openssh.yml
  tags: ['openssh']

- name: Installation des outils communs
  ansible.builtin.import_tasks: tools.yml
  tags: ['tools']

- name: Configuration de ZSH
  ansible.builtin.import_tasks: zsh.yml
  tags: ['zsh']

- name: Création des utilisateurs
  ansible.builtin.import_tasks: users.yml
  tags: ['users']

- name: Configuration des locales
  ansible.builtin.import_tasks: locales.yml
  tags: ['locales']

- name: Configuration de la timezone
  ansible.builtin.import_tasks: timezone.yml
  tags: ['timezone']

- name: Configuration du client NTP
  ansible.builtin.import_tasks: ntp.yml
  tags: ['ntp']
  when: ansible_virtualization_type != "lxc"

- name: Configuration de la swap
  ansible.builtin.import_tasks: swap.yml
  tags: ['swap']
  when: ansible_virtualization_type != "lxc"

- name: Installation de Telegraf
  ansible.builtin.import_role:
    name: telegraf
  tags: ['telegraf']

- name: Installation de Borgmatic
  ansible.builtin.import_role:
    name: borgmatic
  tags: ['borgmatic']

- name: Configuration du port série
  ansible.builtin.include_tasks: serial.yml
  vars:
    serial_number: 0
  tags: ['serial']
  when: ansible_virtualization_type == "kvm" or ansible_product_name == "YL-SKUL6" or ansible_product_name == "PowerEdge R620"

- name: Configuration du port série (HP ProLiant)
  ansible.builtin.include_tasks: serial.yml
  vars:
    serial_number: 1
  tags: ['serial']
  when: ansible_product_name == "ProLiant DL360e Gen8"
