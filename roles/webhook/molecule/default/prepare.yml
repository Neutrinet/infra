---
- name: Prepare
  hosts: all
  become: true

  pre_tasks:
    - name: Mise à jour du cache APT
      ansible.builtin.apt:
        update_cache: true

    - name: Installation de Git
      ansible.builtin.package:
        name: git
        state: present

    - name: Installation des ACL
      ansible.builtin.package:
        name: acl
        state: present

    - name: Création de l'utilisateur webhook
      ansible.builtin.user:
        name: webhook
        home: /var/www/webhook
        shell: /sbin/nologin
        system: true
        state: present

    - name: Récupération du dépôt git de webhook
      ansible.builtin.git:
        repo: https://github.com/adnanh/webhook.git
        dest: /var/www/webhook/dist
        single_branch: true
        version: master
      become: true
      become_user: webhook
