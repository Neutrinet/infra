---
- name: Prepare
  hosts: all
  become: true

  pre_tasks:
    - name: Mise à jour du cache APT
      apt:
        update_cache: true
        cache_valid_time: 3600

    - name: Installation de Git
      package:
        name: git
        state: present

    - name: Installation des ACL
      package:
        name: acl
        state: present

    - name: Création de l'utilisateur webhook
      user:
        name: webhook
        home: /var/www/webhook
        shell: /sbin/nologin
        system: true
        state: present

    - name: Récupération du dépôt git de webhook
      git:
        repo: https://github.com/adnanh/webhook.git
        dest: /var/www/webhook/dist
        single_branch: true
        version: master
      become_user: webhook
