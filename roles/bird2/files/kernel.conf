filter kernel_v4_export {
   krt_prefsrc = my_krt_prefsrc_v4;

   if (proto = "neutrinet_v4") then accept;
   if (proto = "default_gw_v4") then accept;
   if (bgp_large_community ~ [(my_asn, 0, 50)]) then accept;
   if (bgp_large_community ~ [(my_asn, 0, 51)]) then accept;

   if (bgp_large_community ~ [(my_asn, 0, 10)]) then {
      if reject_bogon_asns("import", "{{ peer.location }}")           then reject;
      if reject_long_aspaths("import", "{{ peer.location }}")         then reject;
      if reject_v4_bogon_prefixes("import", "{{ peer.location }}")    then reject;
      if reject_v4_small_prefixes("import", "{{ peer.location }}")    then reject;
      if reject_v4_default_route("import", "{{ peer.location }}")     then reject;
      if reject_v4_invalid_rpki("import", "{{ peer.location }}")      then reject;
      accept;
   }
   if (bgp_large_community ~ [(my_asn, 0, 666)]) then {
      dest = RTD_BLACKHOLE;
      accept;
   }

   reject;
}

filter kernel_v6_export {
   krt_prefsrc = my_krt_prefsrc_v6;

   if (proto = "neutrinet_v6") then accept;
   if (proto = "default_gw_v6") then accept;
   if (bgp_large_community ~ [(my_asn, 0, 50)]) then accept;
   if (bgp_large_community ~ [(my_asn, 0, 51)]) then accept;

   if (bgp_large_community ~ [(my_asn, 0, 10)]) then {
      if reject_bogon_asns("import", "{{ peer.location }}")           then reject;
      if reject_long_aspaths("import", "{{ peer.location }}")         then reject;
      if reject_v6_bogon_prefixes("import", "{{ peer.location }}")    then reject;
      if reject_v6_small_prefixes("import", "{{ peer.location }}")    then reject;
      if reject_v6_default_route("import", "{{ peer.location }}")     then reject;
      if reject_v6_invalid_rpki("import", "{{ peer.location }}")      then reject;
      accept;
   }
   if (bgp_large_community ~ [(my_asn, 0, 666)]) then {
      dest = RTD_BLACKHOLE;
      accept;
   }

   reject;
}

protocol kernel kernel_v4 {
   scan time 60;

   ipv4 {
      import none;
      export filter kernel_v4_export;
   };
}

protocol kernel kernel_v6 {
   scan time 60;

   ipv6 {
      import none;
      export filter kernel_v6_export;
   };
}
