- name: Ajout des sessions upstream
  template:
    src: peer.conf.j2
    dest: "/etc/bird/peers/upstreams/{{ peer.location | lower }}_{{ peer.asn }}_{{ peer.description | lower  | replace(' ', '_') }}.conf"
    owner: bird
    group: bird
    mode: "u=rw,go="
  notify: reload bird
  loop: "{{ bird_peers_upstreams }}"
  loop_control:
    loop_var: peer
    label: "[{{ peer.location }}] {{ peer.description }} {{ peer.asn }}"
  tags: ['bird2_peers']

- name: Ajout des sessions downstream
  template:
    src: peer.conf.j2
    dest: "/etc/bird/peers/downstreams/{{ peer.location | lower }}_{{ peer.asn }}_{{ peer.description | lower  | replace(' ', '_') }}.conf"
    owner: bird
    group: bird
    mode: "u=rw,go="
  notify: reload bird
  loop: "{{ bird_peers_downstreams }}"
  loop_control:
    loop_var: peer
    label: "[{{ peer.location }}] {{ peer.description }} {{ peer.asn }}"
  tags: ['bird2_peers']
#
#- name: Ajout des sessions cymru
#  template:
#    src: cymru.conf.j2
#    dest: "/etc/bird/peers/upstreams/cymru.conf"
#    owner: bird
#    group: bird
#    mode: "u=rw,go="
#  notify: reload bird
#  tags: ['bird2_peers']
#
- name: Ajout de la source kernel
  copy:
    src: kernel.conf
    dest: "/etc/bird/peers/downstreams/kernel.conf"
    owner: bird
    group: bird
    mode: "u=rw,go="
  notify: reload bird
  tags: ['bird2_peers']
