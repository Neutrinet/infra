- name: Installation de Bird2
  package:
    name: bird2
    state: present

- name: Creation des dossiers
  file:
    path: "/etc/bird/{{ item }}"
    state: directory
    owner: bird
    group: bird
    mode: "u=rwx,go="
  with_items:
    - conf.d
    - peers
    - peers/downstreams
    - peers/upstreams

- name: Copie des fichiers de configuration
  copy:
    src: "conf.d/{{ item }}"
    dest: "/etc/bird/conf.d/{{ item }}"
    owner: bird
    group: bird
    mode: "u=rw,go="
  notify: reload bird
  with_items:
    - 00_bgp_filter.conf
    - 00_bgp_filter_v4.conf
    - 00_bgp_filter_v6.conf
    - 00_bgp_match_v4.conf
    - 00_bgp_match_v6.conf
    - 05_bgp_community_calcul.conf
    - 10_device.conf
    - 10_direct.conf
    - 10_static.conf
    - 20_bgp_rpki.conf

- name: Genéré le fichier de configuration de base
  template:
    src: bird.conf.j2
    dest: "/etc/bird/bird.conf"
    owner: bird
    group: bird
    mode: "u=rw,go="
  notify: reload bird

- name: Activation de bird au démarrage
  service:
    name: bird
    state: started
    enabled: true
